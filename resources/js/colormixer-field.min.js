var ColorMixer=function(){return"undefined"!=typeof document.colormixer&&null!==document.colormixer?void document.colormixer.updateInputs():(document.colormixer=this,this.inputs=[],this.updateInputs(),void(this.modal=new ColorMixer.Modal))};ColorMixer.prototype.updateInputs=function(){var e=this;this.inputs=ColorMixer.Unique(this.inputs.concat([].slice.call(document.querySelectorAll("input[data-colormixer]")))),this.inputs.forEach(function(t){function o(t,o){var i=document.createElement("input");i.type="text",i.name=t.name+"[]",i.value=o.alphaHex,i.setAttribute("readonly",!0),i.className="colormixer--color",i.style.backgroundColor=o.rgba,i.addEventListener("click",function(){e.modal.show(i,t.colorMixerSettings)}),t.parentNode.appendChild(i),t.colorMixerSettings.current++}if("undefined"==typeof t.colorMixerSettings){t.colorMixerSettings={colorType:t.dataset.colormixer,current:0,max:parseInt(t.dataset.multiple)<0?99999:parseInt(t.dataset.multiple),showPicker:ColorMixer.Boolean(t.dataset.picker),showSwatches:ColorMixer.Boolean(t.dataset.swatches),showImage:ColorMixer.Boolean(t.dataset.image),showAlpha:ColorMixer.Boolean(t.dataset.alpha),showHex:ColorMixer.Boolean(t.dataset.hex),showRgb:ColorMixer.Boolean(t.dataset.rgb),showCmyk:ColorMixer.Boolean(t.dataset.cmyk),showComplementary:ColorMixer.Boolean(t.dataset.complementary),swatches:t.dataset.swatches?JSON.parse(t.dataset.swatches):[],assetSources:ColorMixer.Boolean(t.dataset.image)&&t.dataset.sources?t.dataset.sources:""};var i=t.value;if(i){if("#"===i[0]){var n=ColorMixer.Color(i);n&&o(t,n)}else if("["===i[0]&&"["!==i[1]){var a=JSON.parse(i);a.forEach(function(e){var i=ColorMixer.Color(e);i&&o(t,i)})}}else;if(t.colorMixerSettings.current<t.colorMixerSettings.max){var r=document.createElement("a");r.className="colormixer--add",r.href="#",r.title="Add another color",r.addEventListener("click",function(e){e.preventDefault()}),t.parentNode.appendChild(r)}}})},ColorMixer.Modal=function(){function e(e){e.preventDefault(),n.getElementsByClassName("sel")[0].classList.remove("sel"),this.classList.add("sel");for(var o in t.elements.bodies)o===this.tabType+"Body"?t.elements.bodies[o].classList.remove("hidden"):t.elements.bodies[o].classList.add("hidden")}var t=this;this.isOpen=!1,this.elements={bodies:{},picker:{}};var o=document.createElement("div");o.id="ColorMixerModal",o.className="pane hidden",o.addEventListener("mousedown",function(e){e.stopPropagation()}),window.addEventListener("mousedown",function(){t.isOpen&&t.hide()}),this.elements.modal=o;var i,n=document.createElement("nav"),a=document.createElement("ul"),r=document.createElement("a"),s=document.createElement("a");n.className="tabs",this.elements.tabs=n,r.className="tab sel",r.textContent="Picker",r.tabType="picker",r.addEventListener("click",e),i=document.createElement("li"),i.appendChild(r),a.appendChild(i),this.elements.pickerTab=r,s.className="tab",s.textContent="Swatches",s.tabType="swatches",s.addEventListener("click",e),i=document.createElement("li"),i.appendChild(s),a.appendChild(i),this.elements.swatchesTab=s,n.appendChild(a),o.appendChild(n);var l=document.createElement("div"),c=document.createElement("div"),h=document.createElement("div");l.className="body",c.className="colormixer-modal--picker",this.elements.picker.colorPicker=ColorMixer.Modal.CreateColorPicker(),c.appendChild(this.elements.picker.colorPicker),l.appendChild(c),this.elements.bodies.pickerBody=c,h.className="colormixer-modal--swatches hidden",h.textContent="SWATCHES",l.appendChild(h),this.elements.bodies.swatchesBody=h,o.appendChild(l);var d=document.createElement("footer"),u=document.createElement("a"),p=document.createElement("button"),m=document.createElement("button");return d.className="footer",u.className="delete",u.textContent="Delete",this.elements.deleteButton=u,p.className="btn",p.textContent="Cancel",p.addEventListener("click",function(){t.hide()}),m.className="btn submit",m.textContent="Select",d.appendChild(u),d.appendChild(p),d.appendChild(m),o.appendChild(d),document.body.appendChild(o),this},ColorMixer.Modal.prototype.show=function(e,t){var o=ColorMixer.GetCoords(e);this.elements.modal.style.top=o.top+e.clientHeight+"px",this.elements.modal.style.left=o.left-24+"px",this.elements.modal.classList.remove("hidden"),this.isOpen=!0},ColorMixer.Modal.prototype.hide=function(){this.elements.modal.classList.add("hidden"),this.isOpen=!1},ColorMixer.Modal.CreateColorPicker=function(){var e=new ColorMixer.Color("#ffff0000"),t=new ColorMixer.Color("#f00"),o=new ColorMixer.Color("#f00"),i=document.createElement("div");i.className="colormixer-modal--color-picker";var n=document.createElement("div"),a=document.createElement("div");n.className="lightness-saturation",a.className="handle",a.style.background=t.rgba,n.appendChild(a),t.onChange=function(){a.style.background=t.rgba,t.s<=15&&t.v>=85?a.classList.add("light"):a.classList.remove("light"),a.classList.contains("dragging")||(a.style.left=t.s+"%",a.style.top=100-t.v+"%")},ColorMixer.Modal.HandleDrag(a,ColorMixer.Modal.HandleDrag.Direction.BOTH,function(i){var n=i.x,a=100-i.y;e.s=n,e.v=a,e.h=o.h,t.s=n,t.v=a,t.h=o.h});var r=document.createElement("div"),s=document.createElement("div");r.className="hue",s.className="handle",s.style.background=o.rgba,r.appendChild(s),o.onChange=function(){var e="rgba("+o.r+", "+o.g+", "+o.b;n.style.background="linear-gradient(to right, "+e+", 0), "+e+", 1))",s.style.background=o.rgba,s.classList.contains("dragging")||(s.style.top=100-o.h/360*100+"%")},ColorMixer.Modal.HandleDrag(s,ColorMixer.Modal.HandleDrag.Direction.Y,function(i){var n=360*(1-i.y/100);e.h=n,o.h=n,t.h=n});var l=document.createElement("div"),c=document.createElement("div");return l.className="alpha",c.className="handle",l.appendChild(document.createElement("span")),c.appendChild(document.createElement("span")),c.firstChild.style.background=e.rgba,l.appendChild(c),e.onChange=function(){var t="rgba("+e.r+", "+e.g+", "+e.b;l.firstElementChild.style.background="linear-gradient(to right, "+t+", 0), "+t+", 1))",c.firstChild.style.background=e.rgba,c.classList.contains("dragging")||(c.style.left=e.alpha+"%")},ColorMixer.Modal.HandleDrag(c,ColorMixer.Modal.HandleDrag.Direction.X,function(t){e.alpha=t.x}),i.appendChild(n),i.appendChild(r),i.appendChild(l),o.onChange(),t.onChange(),e.onChange(),i},ColorMixer.Modal.HandleDrag=function(e,t,o){function i(i){var r={x:(i.clientX-n.left)/a.clientWidth*100,y:(i.clientY-n.top)/a.clientHeight*100};r.y<0&&(r.y=0),r.y>100&&(r.y=100),r.x<0&&(r.x=0),r.x>100&&(r.x=100),t!==ColorMixer.Modal.HandleDrag.Direction.X&&t!==ColorMixer.Modal.HandleDrag.Direction.BOTH||(e.style.left=r.x+"%"),t!==ColorMixer.Modal.HandleDrag.Direction.Y&&t!==ColorMixer.Modal.HandleDrag.Direction.BOTH||(e.style.top=r.y+"%"),o&&o(r)}var n,a=e.parentNode;e.addEventListener("mousedown",function(){n=a.getBoundingClientRect(),e.classList.add("dragging"),window.addEventListener("mousemove",i,!0)}),a.addEventListener("click",function(t){t.target!==e&&(n=a.getBoundingClientRect(),i(t))}),window.addEventListener("mouseup",function(){e.classList.remove("dragging"),window.removeEventListener("mousemove",i,!0)})},ColorMixer.Modal.HandleDrag.Direction={BOTH:1,X:2,Y:3},ColorMixer.Fail=function(e){Craft&&Craft.cp&&Craft.cp.displayError("<strong>Color Mixer:</strong> "+e),window.console&&console.error.apply(console,["%cColor Mixer: %c"+e,"font-weight:bold;","font-weight:normal;"])},ColorMixer.GetCoords=function(e){var t=e.getBoundingClientRect(),o=document.body.getBoundingClientRect();return{top:Math.round(t.top-o.top),left:Math.round(t.left-o.left)}},ColorMixer.Boolean=function(e){return"undefined"!=typeof e&&"true"==e},ColorMixer.Unique=function(e){for(var t=e.concat(),o=0;o<t.length;++o)for(var i=o+1;i<t.length;++i)t[o]===t[i]&&t.splice(i--,1);return t},ColorMixer.Color=function(e){if("string"!=typeof e&&ColorMixer.Fail("Invalid Alpha Hex ("+typeof e+")"),9!==e.length&&("#"!==e[0]&&(e="#"+e),4===e.length&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),7===e.length&&(e="#ff"+e.substring(1)),9!==e.length))return ColorMixer.Fail("Invalid Alpha Hex ("+e+")"),null;var t=function(e){this._hex="#"+e.substring(3,9),this._alpha=parseInt(e.substring(1,3),16)/255,this._r=parseInt(e.substring(3,5),16),this._g=parseInt(e.substring(5,7),16),this._b=parseInt(e.substring(7,9),16);var t=this.r/255,o=this.g/255,i=this.b/255,n=Math.min(t,o,i),a=Math.max(t,o,i),r=a-n;switch(this._k=1-a,this._c=(1-t-this._k)/(1-this._k)||0,this._m=(1-o-this._k)/(1-this._k)||0,this._y=(1-i-this._k)/(1-this._k)||0,this._s=0===a?0:r/a,this._v=a,a){case n:this._h=0;break;case t:this._h=(o-i)/r+(i>o?6:0);break;case o:this._h=(i-t)/r+2;break;case i:this._h=(t-o)/r+4}this._h/=6,this._alphaHex=e};return t.HueToRgb=function(e,t,o){return 0>o&&(o+=1),o>1&&(o-=1),1/6>o?e+6*(t-e)*o:.5>o?t:2/3>o?e+(t-e)*(2/3-o)*6:e},t.prototype={get hex(){return this._hex},set hex(e){this._hex=e,this.updateFromHex()},get alpha(){return~~(100*this._alpha)},set alpha(e){this._alpha=e/100,this.updateFromRgba()},get r(){return~~this._r},set r(e){this._r=e,this.updateFromRgba()},get g(){return~~this._g},set g(e){this._g=e,this.updateFromRgba()},get b(){return~~this._b},set b(e){this._b=e,this.updateFromRgba()},get k(){return 100*this._k},set k(e){this._k=e/100,this.updateFromCmyk()},get c(){return 100*this._c},set c(e){this._c=e/100,this.updateFromCmyk()},get m(){return 100*this._m},set m(e){this._m=e/100,this.updateFromCmyk()},get y(){return 100*this._y},set y(e){this._y=e/100,this.updateFromCmyk()},get h(){return 360*this._h},set h(e){this._h=e/360,this.updateFromHsv()},get s(){return~~(100*this._s)},set s(e){this._s=e/100,this.updateFromHsv()},get v(){return~~(100*this._v)},set v(e){this._v=e/100,this.updateFromHsv()},get alphaHex(){return this._alphaHex},set alphaHex(e){this._alphaHex=e,this.updateFromAlphaHex()},get rgba(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha/100+")"}},t.prototype.onChange=function(){},t.prototype.updateFromCmyk=function(){this._r=255*(1-this._c)*(1-this._k),this._g=255*(1-this._m)*(1-this._k),this._b=255*(1-this._y)*(1-this._k),this.updateFromRgba()},t.prototype.updateFromHsv=function(){var e,t,o,i,n;switch(e=Math.floor(6*this._h),t=6*this._h-e,o=this._v*(1-this._s),i=this._v*(1-t*this._s),n=this._v*(1-(1-t)*this._s),e%6){case 0:this._r=this._v,this._g=n,this._b=o;break;case 1:this._r=i,this._g=this._v,this._b=o;break;case 2:this._r=o,this._g=this._v,this._b=n;break;case 3:this._r=o,this._g=i,this._b=this._v;break;case 4:this._r=n,this._g=o,this._b=this._v;break;case 5:this._r=this._v,this._g=o,this._b=i}this._r*=255,this._g*=255,this._b*=255,this.updateFromRgba()},t.prototype.updateFromRgba=function(){var e=this;this._alphaHex=function(){function t(e){return 1===(e+"").length?"0"+e:e}var o=t((~~(255*e._alpha)).toString(16)),i=t(e.r.toString(16)),n=t(e.g.toString(16)),a=t(e.b.toString(16));return"#"+o+i+n+a}(),this.updateFromAlphaHex()},t.prototype.updateFromHex=function(){this._alphaHex="#"+(255*this._alpha).toString(16)+this._hex.substring(1),this.updateFromAlphaHex()},t.prototype.updateFromAlphaHex=function(){var e=new ColorMixer.Color(this._alphaHex);for(var t in this)"_"===t[0]&&(this[t]=e[t]);this.onChange()},new t(e)};